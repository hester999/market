# Market — REST API маркетплейса

## Описание

Это приложение реализует REST API условного маркетплейса на Go с использованием принципов чистой архитектуры.

**Возможности:**
- Авторизация пользователей
- Регистрация пользователей
- Размещение новых объявлений
- Отображение ленты объявлений

API реализован в формате **REST + JSON**.  
В проекте используется PostgreSQL, всё упаковано в Docker-контейнеры.

---

## Как запустить

### 1. Через Docker Compose (рекомендуется)

```sh
docker compose up --build
```

- Приложение будет доступно на [http://localhost:8080](http://localhost:8080)
- Swagger-документация: [http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)
- База данных PostgreSQL поднимается автоматически

### 2. Локально (Go 1.24+)

```sh
cd app
make build
./build/app
```

> Не забудьте поднять PostgreSQL и прописать переменную окружения `DATABASE_URL` (см. docker-compose.yaml).

---

## Особенности реализации

- **Строка подключения к БД:**  
  В папке `internal/db` зашита строка подключения для тестирования на локальной машине. Для продакшена рекомендуется использовать переменные окружения.

- **Коллекция Postman:**  
  В проекте есть коллекция запросов (`market Copy.postman_collection.json`) для тестирования API.  
  ⚠️ Для тестирования некоторых запросов (например, требующих токен, session, ID объявлений или картинок) значения нужно подставлять вручную.

- **Загрузка изображений:**  
  Картинки можно загружать через `form-data`.
  - При тестировании на локалке файлы сохраняются в `/internal/static`
  - При сборке через Docker — в `/market/static`

---

## Структура проекта

```
app/internal/entity/      — доменные сущности (user, ads, image и др.)
app/internal/usecases/    — бизнес-логика (usecase-ы по доменам)
app/internal/repo/        — репозитории для доступа к данным (PostgreSQL)
app/internal/handler/     — HTTP-обработчики (разделены по доменам)
app/internal/mapper/      — преобразование между слоями (DTO ↔ entity)
app/internal/apperr/      — централизованная обработка ошибок
app/internal/middleware/  — middleware (например, аутентификация)
app/internal/router/      — маршрутизация
app/internal/db/          — инициализация БД, строка подключения
app/static/               — статика и загруженные изображения
app/docs/                 — Swagger/OpenAPI спецификация
```

---

## Реализовано

### Авторизация пользователей
- Авторизация через логин и пароль (JSON)
- Генерация и возврат токена при успешной авторизации
- Токен передаётся в заголовке Authorization
- Проверка токена на каждом защищённом эндпоинте

### Регистрация пользователей
- Регистрация через логин и пароль (JSON)
- Валидация формата логина и пароля
- В ответе — данные зарегистрированного пользователя

### Размещение объявлений
- Только авторизованные пользователи могут размещать объявления
- Валидация длины заголовка, текста, цены, формата изображения
- В ответе — данные созданного объявления

### Лента объявлений
- Список объявлений, отсортированный по дате (свежие — в начале)
- Постраничная навигация, сортировка, фильтрация по типу и цене
- Для каждого объявления: заголовок, текст, изображения, цена, логин автора, признак принадлежности текущему пользователю

### Документация
- Swagger UI: `/swagger/index.html`
- OpenAPI спецификация: `app/docs/swagger.yaml`

---

## Пример запросов

Коллекция Postman: `market Copy.postman_collection.json`

> ⚠️ Для тестирования некоторых запросов (например, требующих токен, session, ID объявлений или картинок) значения нужно подставлять вручную.

---

## Контейнеризация

- Всё приложение и БД запускаются одной командой через Docker Compose
- Для хранения изображений используется volume: `./static/upload:/app/static/upload`

---

## Требования

- Go 1.24+
- Docker, Docker Compose

---

## Что можно улучшить

1. **Покрыть проект тестами**  
   Добавить unit- и интеграционные тесты для основных слоёв (usecases, handlers, repo).
2. **Привести переменные к единому типу**  
   Стандартизировать типы переменных (например, id, session, user_id и т.д.) по всему проекту.
3. **Рефакторинг DTO и мапперов**  
   Упростить и почистить структуры DTO и логику мапперов, убрать дублирование, привести к единому стилю.

---

## Ссылки

- [Swagger UI](http://localhost:8080/swagger/index.html)
